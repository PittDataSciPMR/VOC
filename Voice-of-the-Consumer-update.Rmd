---
title: Automated vehicle Services for People with disabilities â€“ Involved Responsive
  Engineering (ASPIRE Center)
author: "Sanmi"
date: "5/9/2022"
output:
  html_document:
    toc: yes
    fig_width: 10
  pdf_document:
    toc: yes
---
<a name="top"></a>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



**Aim 3: Data synthesis, extrapolation, analysis and modeling:**  



**Questions:**  
**What are the current transportation practices of individuals with disabilities?**  

  - What are the **primary modes of transportation** (i.e. fixed route public bus, shared, personal vehicle-passenger, personal vehicle-driver, Rideshare app (Uber or Lyft), automated vehicles, etc.)?  

  - What are the **usage rates** for each mode of transportation?  

**What are the current perceptions (e.g. barriers/facilitators) of individuals with disabilities regarding accessibility of each mode of transportation?**  

  - How often to people experience barriers with getting to where they need to go in the community for these modes of transportation?
  If the traveler with a disability is a parent, child, sibling, or spouse, how does that role affect accessible travel? If the travel companion of the person with a disability is a parent, child, sibling, spouses or relative how does that role affect accessible travel?
  
  - How much do barriers with current modes of transportation and transportation related services (e.g. access to adaptive driving training programs, vehicle modifications, paratransit, ride share) affect access to accessible transportation?


**How much do barriers with transportation and transportation related services (e.g. access to adaptive driving training programs, vehicle modifications, paratransit, ride share) impact community participation?** 


  - How frequently do barriers with transportation and related services impact community participation for essential (e.g. medical, work, school, grocery etc.) and less essential (e.g. social and recreational events, etc.) activities and locations
ASPIRE Center  

  - What are the primary reasons for these problems (e.g. too costly, scheduling inconveniences, unreliable, unsafe, requires specialized equipment/adaptations, unable to accommodate additional travelers (spouse, child, service animal, attendant)  
  
  - What are the anticipated barriers/facilitators to using automated vehicles for transportation?  
  
  - What vehicle features or services would be needed to make automated vehicles accessible?  
  
  - What potential impact (influence) could accessible automated vehicles have on community participation?  
  
  
  
Others

Are there any floor/ceiling effects? If so, do the questions need to be modified?  
What is the consensus on AV/ATS amongst disability groups?  
Is there a disparity across geographical locations?  
Are there differing viewpoints across disability groups?  
What areas of autonomous vehicle development should be a priority (e.g. wheelchair securement)?  

Function to estimate fisher exact test and load packages
```{r echo=TRUE, message=FALSE, warning=FALSE}
rm(list = ls())
pack<-function(x){
  for (i in x){
    if (!require(i,character.only = T)){
      install.packages(i,dependencies = T,repos="https://cran.rstudio.com")
      require(i,character.only = T)
    }
  }
}

pvalue <- function(x, ...) {                                                                                                                                                                                                                                                                                
    # Construct vectors of data y, and groups (strata) g
    y <- unlist(x)
    g <- factor(rep(1:length(x), times=sapply(x, length)))
    #if (is.numeric(y)) {
    #    # For numeric variables, perform a standard 2-sample t-test
    #    p <- t.test(y ~ g)$p.value
    #} else 
      {
        # For categorical variables, perform a chi-squared test of independence
        p <- fisher.test(table(y, g),simulate.p.value = T)$p.value
    }
    # Format the p-value, using an HTML entity for the less-than sign.
    # The initial empty string places the output on the line below the variable label.
    c("", sub("<", "&lt;", format.pval(p, digits=3, eps=0.001)))
}

pack(c("readr","dplyr","tidyr","ggplot2", "lubridate","gtsummary","stringr","readxl","tidyr","kableExtra","table1","broom"))
pack("table1")
pack("DT")

```

Load files and create data/labels dictionary
```{r message=FALSE, warning=FALSE}
dataf <- read_excel("Clean_VoC_April_DATA.xlsx")
data_labels <- read_excel("Cleaned_VoC_April_DATA_LABELS.xlsx")
state_census<- read_csv("state census - Sheet1.csv")

labs<-colnames(data_labels)
colnames(data_labels)<-colnames(dataf)
dataf<-data_labels
dataf<-dataf[order(dataf$fwat_id),]


data.dict<-data.frame(labels=colnames(dataf),surveyq=labs)

dataf%>%
  select(dpct)%>%
  table()

#dataf<-dataf%>%
#  filter(dpct=="Person with a disability")

```


# Data dictionary
```{r}
datatable(data.dict)
```

Count conditions
```{r}
#reported conditions
```


Classify states into regions
```{r include=FALSE}
#
Northeast<-c("Connecticut",
"Maine", 
"Massachusetts",
"New Hampshire",
"Rhode Island",
"Vermont", 	
"New Jersey",
"New York",
"Pennsylvania")

Midwest<-c("Indiana",
"Illinois",
"Michigan",
"Ohio",
"Wisconsin",
"Iowa",
"Nebraska",
"Kansas",
"North Dakota",
"Minnesota",
"South Dakota",
"Missouri")

South<-c("Arkansas",
"Louisiana",
"Oklahoma",
"Texas",
"Alabama",
"Kentucky",
"Mississippi",
"Tennessee",
"Delaware",
"District of Columbia",
"Florida",
"Georgia",
"Maryland",
"North Carolina",
"South Carolina",
"Virginia",
"West Virginia")


West<-c("Alaska",
"California",
"Hawaii",
"Oregon",
"Washington",

"Montana",
"Utah",
"Nevada",
"Wyoming",
"Arizona",
"Colorado",
"Idaho",
"New Mexico")

```



```{r}
#loop to replace the participant entered state with regions and divisions
dataf$regions<-NA
dataf$divisions<-NA
for (i in 1:nrow(dataf)){
  for (j in 1:nrow(state_census)){
    if((dataf$state[i] == state_census$`State Code`[j])&
       !is.na(dataf$state[i])){
      dataf$regions[i]<-state_census$Region[j]
      dataf$divisions[i]<-state_census$Division[j]
    }
    else if (is.na(dataf$state[i])){
      dataf$regions[i]<-NA
      dataf$divisions[i]<-NA}
  }
}

#confirm replacement
dataf%>%
  select(state,regions,divisions)%>%
  datatable()

```

Disability types

```{r}

disab_type<-c("Hearing difficulty",
              "Vision difficulty",
              "Cognitive difficulty",
              "Ambulatory difficulty",
              "Self-care difficulty",
              "Independent living difficulty")
discol<-c(5:10)

for (i in 1:nrow(dataf)){
  for (j in discol){
    if (dataf[i,j]=="Checked"){dataf$disab_type[i]<-disab_type[j-4]}
    }
  }

```

<a href="#top">----------------------------------------------------------------------------------Back to top of page</a>  



```{r}

dataf$Diagnosis<-NA
dataf$Num_conditions<-NA

for (i in 1:nrow(dataf)){
  Dx<-c()
  for (j in discol){
    if (dataf[i,j]=="Checked"){Dx[length(Dx)+1]<-disab_type[j-4]}
  }
  dataf$Num_conditions[i]<-length(Dx)
  dataf$Diagnosis[i]<-paste0("",Dx,collapse = ", ")
}

dataf$Diagnosis[dataf$Diagnosis==""]<-"No checked condition"
dataf$Num_conditions<-as.character(dataf$Num_conditions)

dataf<-dataf%>%
  mutate(disab_type_2=if_else(Num_conditions>1,"Multiple Disability Types",Diagnosis))



```

Persons with disability only   

```{r}

dizz<-dataf[,c(1,4,5:10,201,202,203,11)]


dizz_na<-dizz%>%
  filter(Diagnosis=="No checked condition")
 #people with no diagnosis checked

#Number of people who didn't select any disability type
nrow(dizz_na) #there are 145 people with no diagnosis checked

dizz_notna<-dizz%>%
  filter(Diagnosis!="No checked condition")

#Distribution of those who didnt select a DISABILITY TYPE
dizz_na%>%
  group_by(dpct)%>%
  summarize(n=n())%>%
  kable()


```

```{r}
dataf<-dataf%>%
  filter(Diagnosis!="No checked condition")


write.csv(dizz_na,"Subject who Checked no condition.csv")
```



```{r}
#write.csv(dizz, "dizz.csv")
#read.csv(dizz, "dizz.csv")
```

# Raw table distribution of demographic characteristics
```{r}

table1(~ ethnicity+race+gender+age+marit_stat+education+time_living_disability+regions+divisions+
         connect_transpo+comfortable_av+price_range+hous_sit+
         employment+income+veteran+zip_cd+state+lived_other | disab_type_2,data = dataf,rowlabelhead = "Characteristics by disability type")

```

Remove those without checked condition
```{r}
table1(~ ethnicity+race+gender+age+marit_stat+education+time_living_disability+regions+divisions+
         connect_transpo+comfortable_av+price_range+hous_sit+
         employment+income+veteran+zip_cd+state+lived_other | disab_type_2,data = dataf%>%filter(Diagnosis!="No checked condition"),rowlabelhead = "Characteristics by disability type")


```


# Table S1. Descriptive (Excluding participants with multiple disability types)

```{r}

table1(~ ethnicity+race+gender+age+marit_stat+education+time_living_disability+regions+divisions+
         connect_transpo+comfortable_av+price_range+hous_sit+
         employment+income+veteran+zip_cd+state+lived_other
         | Diagnosis,data = dataf%>%filter(Num_conditions<2),rowlabelhead = "Characteristics by disability type")

```


# Table S2. Descriptive (expounding on those with multiple disability types)
```{r}

#state+
#+occupation  
table1(~ ethnicity+race+gender+age+marit_stat+education+time_living_disability+regions+divisions+
         connect_transpo+comfortable_av+price_range+hous_sit+
         employment+income+veteran+zip_cd+state+lived_other
         | Diagnosis,data = dataf%>%filter(Num_conditions>1),rowlabelhead = "Characteristics by disability type")

dataf_statena<-dataf[which(is.na(dataf$state)),]

table(dataf_statena$zip_cd)
```

Race and ethnicity into 1
```{r}
dataf<-dataf%>%
  mutate(
          'Age_Group'=case_when(
           age <45~"Less than 45",
           age %in% c(45:64)~"45 to 64",
           age >64 ~"More than 65"),
         
         'Sex'=case_when(
           gender=="Female"~"Female",
           gender=="Male"~"Male",
           gender %in% c("Non-binary/third gender","Prefer not to answer",
                         "Transgender: Female to Male","Transgender: Male to Female","Non-binary/third gender") ~ "Others"),
         
         'Marital Status'=case_when(
           marit_stat=="Single"~"Single",
           marit_stat==2~"Married",
           marit_stat==3~"Others")
  )

#Race and ethnicity into 1
#Gender into male, female, others
#Education into Education into some high-school, high-school, post-high-school, advanced deg

```


Write function to summarize multiple choice questions
```{r}

domulti_sum<-function(df){
    datalist=list()
for (i in 1:ncol(df)){
  dat<-data.frame(
    n=table(df[,i])["Checked"],
    percent=((table(df[,i])["Checked"])/nrow(df))*100,
    row.names = colnames(df)[i]) # maybe you want to keep track of which iteration produced it?
  datalist[[i]] <- dat # add it to your list
}
    big_data = do.call(rbind, datalist)
 #   big_data<-big_data%>%
#      mutate('n (%)'=paste(n,"(",percent,")"))
    return(big_data)
  }

```


# Table 1. Demographic Characteristics (double counting)
## Distribution of respondents in each category (double counting)    

```{r}

d<-c()
p<-c()
  for (j in 5:10){
    d[length(d)+1]<-colnames(dataf)[j]
    p[length(p)+1]<-length(which(dataf[,j]=="Checked"))
  }


datatable(data.frame(unlist(d),unlist(p),
                     row.names = c("Hearing difficulty",
                                   "Vision difficulty",
                                   "Cognitive difficulty",
                                   "Ambulatory difficulty",
                                   "Self-care difficulty",
                                   "Independent living difficulty")))

```


## Ambulatory difficulty
```{r echo=FALSE}

#Ambulatory

#Ethnicity
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___4=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```

## Cognitive difficulty
```{r echo=FALSE}

#Ambulatory



#Ethnicity
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___3=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```

## Hearing difficulty
```{r echo=FALSE}

#Ambulatory



#Ethnicity
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___1=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```

## Independent living difficulty
```{r echo=FALSE}

#Ambulatory



#Ethnicity
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___6=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```

## Self-care difficulty
```{r echo=FALSE}

#Ambulatory



#Ethnicity
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___5=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```

## Vision difficulty
```{r echo=FALSE}

#Ambulatory



#Ethnicity
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(ethnicity)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)%>%

  
  #race      
    bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(race)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#gender
    bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(gender)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
    
  )%>%


#Age

    bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(age)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%


#Marital status
    bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(marit_stat)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%

#education
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(education)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#time_living_disability
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(time_living_disability)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#regions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(regions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #divisions
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(divisions)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #connect_transpo
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(connect_transpo)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #comfortable_av
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(comfortable_av)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #price_range
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(price_range)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #hous_sit
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(hous_sit)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #employment
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(employment)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  #income
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(income)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#veteran
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(veteran)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
#lived_other
      bind_rows(
dataf%>%
  filter(person_w_disabilty___2=="Checked")%>%
  group_by(lived_other)%>%
  summarise(n=n()) %>%
  mutate('N (%)'=paste0(n," ","(",round(((n/sum(n))*100),2),")"))%>%
  select(-n)
)%>%
  datatable()



```


# Survey response summary  

## All participants  


### What are the current transportation practices of individuals with disabilities?  
#### What are your current modes of transportation?  

```{r}
#transport modes
transport_modes<-domulti_sum(dataf[,14:20])
rownames(transport_modes)<-c("Licensed Driver or Permit holder of a Personally Owned or Leased Vehicle",
                        "Passenger of a Personally Owned or Leased Vehicle",
                        "Ground Public Transportation (e.g., paratransit, fixed route bus, train, subway, etc.)",
                        "Ground Private Transportation (e.g., Uber, Lyft, Taxi)",
                        "Light rail or train air taxi (flying vehicles or drones)",
                        "Air travel (e.g., planes, helicopters)",
                        "Water travel (e.g., boat, ferry, water taxi)")
datatable(transport_modes)
transport_modes%>%
  mutate(x=rownames(transport_modes),
         percent=paste(round(percent,1),"%",sep = ""))%>%
  ggplot(aes(x=reorder(x,-n), y=n,label=percent))+
  geom_bar(stat="identity", color="black")+
  geom_text(nudge_y = -10)+
  xlab("Modes of transportation") + 
  ylab("Number of Participants") +  
  ggtitle(str_wrap("What are your current modes of transportation?",70))+
  scale_fill_manual(values = "#E63F00")+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 18))+
  theme(
    plot.title = element_text(face="bold.italic"),
    axis.title.x = element_text(face="bold"),
    axis.title.y = element_text(face="bold"))
  



```

#### Vehicles you would be willing to use:
```{r}
#av systems
av_systems<-domulti_sum(dataf[,22:27])


rownames(av_systems)<-c("Full-size buses",
                        "Mini-buses or multi-passenger van ride-share",
                        "Van or mini-vans",
                        "Cars",
                        "Light rail or train air taxi (flying vehicles or drones)",
                        "Others")
datatable(av_systems)
av_systems%>%
  mutate(x=rownames(av_systems),
         percent=paste(round(percent,1),"%",sep = ""))%>%
  ggplot(aes(x=reorder(x,-n), y=n,label=percent))+
  geom_bar(stat="identity", color="black")+
  geom_text(nudge_y = -10)+
  xlab("Autonomous Vehicles (AV) and Autonomous Transportation Systems (ATS)") + 
  ylab("Number of Participants") +  
  ggtitle(str_wrap("If Autonomous Vehicles (AV) and Autonomous Transportation Systems (ATS) were available, please indicate the following types of vehicles you would be willing to use",70))+
  scale_fill_manual(values = "#E63F00")+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 18))+
  theme(
    plot.title = element_text(face="bold.italic"),
    axis.title.x = element_text(face="bold"),
    axis.title.y = element_text(face="bold"))
  

```

#### Technologies you would be able to use to arrange a ride in an AV or ATS 
```{r}
#arrg_ride_tech
arrg_ride_tech<-domulti_sum(dataf[,29:35])
datatable(arrg_ride_tech)

```

#### Methods you would be willing to use to arrange a ride in an AV or ATS 
```{r}
#meth_arrg_ride___1
meth_arrg_ride<-domulti_sum(dataf[,37:43])
datatable(meth_arrg_ride)
```

### Activities you would use AV or ATS to access
```{r}
#activities_access___1
activities_access<-domulti_sum(dataf[,45:51])
datatable(activities_access)
```

### Services you would use AV and ATS for:
```{r}
services_use<-domulti_sum(dataf[,53:58])
datatable(services_use)
```

### If AV and ATS were available for fixed routes (fixed schedule) similar to public bus schedules, options you would use:
```{r}
fixed_rte_opt<-domulti_sum(dataf[,61:65])
datatable(fixed_rte_opt)
```

### If AV and ATS were available for custom routes (on-demand/not on a fixed schedule, customized pick-up and drop-off points), options you would use: 
```{r}
custom_rtes<-domulti_sum(dataf[,67:71])
datatable(custom_rtes)
```

### Accessibility features of an AV and/or ATS you would require
```{r}
access_features<-domulti_sum(dataf[,73:81])
datatable(access_features)
```

### What other forms of transportation would you like to be able to access using AV and ATS?
```{r}
other_forms_transpo<-domulti_sum(dataf[,85:92])
datatable(other_forms_transpo)

```

### Which of the following AV services can you see yourself using?
```{r}
av_services_using<-domulti_sum(dataf[,(96:102)])
datatable(av_services_using)
```

### Automated or automated driver assist features would you be interested in having in vehicle:
```{r}
pers_vehicle_asst_feat<-domulti_sum(dataf[,104:116])
datatable(pers_vehicle_asst_feat)
```

### Where would a personally owned AV be most valuable to you:
```{r}
pers_av_value<-domulti_sum(dataf[,118:123])
datatable(pers_av_value)

```

```{r}

library(tidyr)
library("RVAideMemoire")


```
----------------------------------------------------------------------

## Survey response summary by disability types
```{r}

#r
```

### Question 2
```{r}

#Modify data into long format and display by disability types  
dataf$id<-c(1:nrow(dataf))

x.labs<-c("Full-size buses",
  "Mini-buses or multi-passenger van ride-share",
  "Van or mini-vans",
  "Cars",
  "Light rail or train air taxi (flying vehicles or drones)",
  "Others")

#2
q2<-dataf%>%
  gather(TransportModes,
         TransportModesCheck,
         transpo_modes___1:transpo_modes___7,
         factor_key = T)#%>%
#  case_when()

q2$TransportModesFact<-q2$TransportModesCheck=="Checked"


#q2%>%
#  filter(TransportModesCheck=="Checked")%>%
#  group_by(disab_type_2)%>%
#  mutate(percent=(n()/nrow(q2))*100)%>%
#  ggplot(aes(x=disab_type_2,label=percent))+
#  geom_bar(stat = "identity")+
 # facet_wrap(~ disab_type)+
  #geom_text(nudge_y = -10)+
#  xlab("Autonomous Vehicles (AV) and Autonomous Transportation Systems (ATS)") + 
#  ylab("Number of Participants")+
#  scale_x_discrete(labels = x.labs)


q2%>%
  group_by(disab_type_2,TransportModes)%>%
  summarize(N_disab=n(), #all the people that responded to the question, i.e. said Yes or No
            n=round(sum(TransportModesCheck=="Checked"),2), #all the people that said Yes
            'n (%)'=paste0
            (
              sum(TransportModesCheck=="Checked"),
              " ",
              "(",
              round(sum(TransportModesCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

 q2%>%
    group_by(disab_type_2,TransportModes,TransportModesCheck)%>%
    mutate(N_disab=n())%>%
   distinct(disab_type_2,TransportModes,TransportModesCheck,.keep_all = T)%>%
   filter(TransportModesCheck=="Checked")%>%
   ggplot(aes(x=reorder(disab_type_2,desc(N_disab)),y=N_disab))+
   geom_col(aes(fill=TransportModes),width = 1,color="black")
 

```


```{r}
 
xtabs(~TransportModes,
        data = q2%>%
  filter(TransportModesFact==T))

#cochran q test for tmodes
cochran.qtest(formula = TransportModesFact~TransportModes|id,data = q2,alpha = 0.05,p.method = "fdr")

#cochran q test for disab types


#transport_modes%>%
#  mutate(x=rownames(transport_modes),
#         percent=paste(round(percent,1),"%",sep = ""))%>%
#  ggplot(aes(x=reorder(x,-n), y=n,label=percent))+
#  geom_bar(stat="identity", color="black")+
#  geom_text(nudge_y = -10)+
#  xlab("Modes of transportation") + 
#  ylab("Number of Participants") +  
#  ggtitle(str_wrap("What are your current modes of transportation?",70))+
#  scale_fill_manual(values = "#E63F00")+
#  scale_x_discrete(labels = function(x) str_wrap(x, width = 18))+
#  theme(
#    plot.title = element_text(face="bold.italic"),
#    axis.title.x = element_text(face="bold"),
#    axis.title.y = element_text(face="bold"))



```

## Question 3
```{r}
#3
q3<-dataf%>%
  gather(AVsystems,
         AVsystemsCheck,
         av_systems___1:av_systems___6,
         factor_key = T)

q3$AVsystemsFact<-q3$AVsystemsCheck=="Checked"


q3%>%
  group_by(disab_type,AVsystems)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(AVsystemsCheck=="Checked"),
              " ",
              "(",
              round(sum(AVsystemsCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()


xtabs(~AVsystems,
        data = q3%>%
  filter(AVsystemsFact==T))

#cochran q test for tmodes
cochran.qtest(formula = AVsystemsFact~AVsystems|id,data = q3,alpha = 0.05,p.method = "fdr")

```
## Question 4

```{r}

#q4
q4<-dataf%>%
  gather(TechArrangeride,
         ArrangerideCheck,
         arrg_ride_tech___1:arrg_ride_tech___8,
         factor_key = T)

q4$ArrangerideFact<-q4$ArrangerideCheck=="Checked"


q4%>%
  group_by(disab_type,TechArrangeride)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(ArrangerideCheck=="Checked"),
              " ",
              "(",
              round(sum(ArrangerideCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()


xtabs(~TechArrangeride,
        data = q4%>%
  filter(ArrangerideFact==T))

#cochran q test for tmodes
cochran.qtest(formula = ArrangerideFact~TechArrangeride|id,data = q4,alpha = 0.05,p.method = "fdr")


```
## Question 5

```{r}

#q5
q5<-dataf%>%
  gather(MethodArrangeride,
         MethodArrangerideCheck,
         meth_arrg_ride___1:meth_arrg_ride___7,
         factor_key = T)


q5$MethodArrangerideFact<-q5$MethodArrangerideCheck=="Checked"


q5%>%
  group_by(disab_type,MethodArrangeride)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(MethodArrangerideCheck=="Checked"),
              " ",
              "(",
              round(sum(MethodArrangerideCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()


xtabs(~MethodArrangeride,
        data = q5%>%
  filter(MethodArrangerideFact==T))

#cochran q test for tmodes
cochran.qtest(formula = MethodArrangerideFact~MethodArrangeride|id,data = q5,alpha = 0.05,p.method = "fdr")


```
## Question 6

```{r}

#q6
q6<-dataf%>%
  gather(MethodArrangeride,
         MethodArrangerideCheck,
         meth_arrg_ride___1:meth_arrg_ride___7,
         factor_key = T)
```
## Question 7

```{r}

#q7
q7<-dataf%>%
  gather(Activities_access,
         Activities_accessCheck,
         activities_access___1:activities_access___7,
         factor_key = T)



q7$Activities_accessFact<-q7$Activities_accessCheck=="Checked"


q7%>%
  group_by(disab_type,Activities_access)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(Activities_accessCheck=="Checked"),
              " ",
              "(",
              round(sum(Activities_accessCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()


xtabs(~Activities_access,
        data = q7%>%
  filter(Activities_accessFact==T))

#cochran q test for tmodes
cochran.qtest(formula = Activities_accessFact~Activities_access|id,data = q7,alpha = 0.05,p.method = "fdr")


```
## Question 8

```{r}

#q8
q8<-dataf%>%
  gather(Services_use,
         Services_useCheck,
         services_use___1:services_use___6,
         factor_key = T)

q8$Services_useFact<-q8$Services_useCheck=="Checked"

q8%>%
  group_by(disab_type,Services_use)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(Services_useCheck=="Checked"),
              " ",
              "(",
              round(sum(Services_useCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()


xtabs(~Services_use,
        data = q8%>%
  filter(Services_useFact==T))

#cochran q test for tmodes
cochran.qtest(formula = Services_useFact~Services_use|id,data = q8,alpha = 0.05,p.method = "fdr")


```
## Question 9

```{r}

#q9
q9<-dataf%>%
  gather(fixed_routes,
         fixed_routesCheck,
         fixed_rte_opt___1:fixed_rte_opt___5,
         factor_key = T)

q9$fixed_routesFact<-q9$fixed_routesCheck=="Checked"

q9%>%
  group_by(disab_type,fixed_routes)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(fixed_routesCheck=="Checked"),
              " ",
              "(",
              round(sum(fixed_routesCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~fixed_routes,
        data = q9%>%
  filter(fixed_routesFact==T))

#cochran q test for tmodes
cochran.qtest(formula = fixed_routesFact~fixed_routes|id,data = q9,alpha = 0.05,p.method = "fdr")


```
## Question 10

```{r}

#q10
q10<-dataf%>%
  gather(access_features,
         	access_featuresCheck,
         	access_features___1:access_features___9,
         factor_key = T)

q10$access_featuresFact<-q10$access_featuresCheck=="Checked"

q10%>%
  group_by(disab_type,access_features)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(access_featuresCheck=="Checked"),
              " ",
              "(",
              round(sum(access_featuresCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~access_features,
        data = q10%>%
  filter(access_featuresFact==T))

#cochran q test for tmodes
cochran.qtest(formula = access_featuresFact~access_features|id,data = q10,alpha = 0.05,p.method = "fdr")


```

## Question 11

```{r}

#q11
q11<-dataf%>%
  gather(other_forms_transpo,
         other_forms_transpoCheck,
         other_forms_transpo___1:other_forms_transpo___8,
         factor_key = T)

q11$other_forms_transpoFact<-q11$other_forms_transpoCheck=="Checked"

q11%>%
  group_by(disab_type,other_forms_transpo)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(other_forms_transpoCheck=="Checked"),
              " ",
              "(",
              round(sum(other_forms_transpoCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~other_forms_transpo,
        data = q11%>%
  filter(other_forms_transpoFact==T))

#cochran q test for tmodes
cochran.qtest(formula = other_forms_transpoFact~other_forms_transpo|id,data = q11,alpha = 0.05,p.method = "fdr")


```


## Question 12

```{r}
#q12

q12<-dataf%>%
  gather(av_services_using,
         av_services_usingCheck,
         av_services_using___1:av_services_using___7,
         factor_key = T)

q12$av_services_usingFact<-q12$av_services_usingCheck=="Checked"

q12%>%
  group_by(disab_type,av_services_using)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(av_services_usingCheck=="Checked"),
              " ",
              "(",
              round(sum(av_services_usingCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~av_services_using,
        data = q12%>%
  filter(av_services_usingFact==T))

#cochran q test for tmodes
cochran.qtest(formula = av_services_usingFact~av_services_using|id,data = q12,alpha = 0.05,p.method = "fdr")


```

## Question 14

```{r}

#q14
q14<-dataf%>%
  gather(pers_vehicle_asst,
         pers_vehicle_asstCheck,
         pers_vehicle_asst_feat___1:pers_vehicle_asst_feat___13,
         factor_key = T)

q14$pers_vehicle_asstFact<-q14$pers_vehicle_asstCheck=="Checked"

q14%>%
  group_by(disab_type,pers_vehicle_asst)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(pers_vehicle_asstCheck=="Checked"),
              " ",
              "(",
              round(sum(pers_vehicle_asstCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~pers_vehicle_asst,
        data = q14%>%
  filter(pers_vehicle_asstFact==T))

#cochran q test for tmodes
cochran.qtest(formula = pers_vehicle_asstFact~pers_vehicle_asst|id,data = q14,alpha = 0.05,p.method = "fdr")


```

### Question 13
```{r}
#q13
q13<-dataf%>%
  gather(pers_av_value,
         pers_av_valueCheck,
         pers_av_value___1:pers_av_value___6,
         factor_key = T)

q13$pers_av_valueFact<-q13$pers_av_valueCheck=="Checked"

q13%>%
  group_by(disab_type,pers_av_value)%>%
  summarize(N_disab=n(),
            'n (%)'=paste0
            (
              sum(pers_av_valueCheck=="Checked"),
              " ",
              "(",
              round(sum(pers_av_valueCheck=="Checked")/n()*100,2),
              ")"
              )
            )%>%
  datatable()

xtabs(~pers_av_value,
        data = q13%>%
  filter(pers_av_valueFact==T))

#cochran q test for tmodes
cochran.qtest(formula = pers_av_valueFact~pers_av_value|id,data = q13,alpha = 0.05,p.method = "fdr")

```

```{r eval=FALSE, include=FALSE}

dataf%>%
  group_by(fwat_id,)%>%
  
  #mutate(x=rownames(av_systems),
  #       percent=paste(round(percent,1),"%",sep = ""))%>%
  ggplot(aes(x=reorder(x,-n), y=n,label=percent))+
  geom_bar(stat="identity", color="black")+
  geom_text(nudge_y = -10)+
  xlab("Autonomous Vehicles (AV) and Autonomous Transportation Systems (ATS)") + 
  ylab("Number of Participants") +  
  ggtitle(str_wrap("If Autonomous Vehicles (AV) and Autonomous Transportation Systems (ATS) were available, please indicate the following types of vehicles you would be willing to use",70))+
  scale_fill_manual(values = "#E63F00")+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 18))+
  theme(
    plot.title = element_text(face="bold.italic"),
    axis.title.x = element_text(face="bold"),
    axis.title.y = element_text(face="bold"))
  



```



## Caregivers of persons with disability    


----------------------------------------------------------------------

# Issues:

1. For questions "Please choose the answer which best describes you for survey
purposes." - you can only select one choice of   
 - Person with a disability  
 - Partner/Caregiver of person(s) with a disability  
 - Older Adult (65+)  
 
If a participant has 2/3 roles, they will have to repeat the survey 2ce/3ce.  
This potentially introduces bias as the responses they provide at each of these instances might be different.  

They may give a question more or less thought when re-answering them.  
This could affect the internal validity of the results since responses from people who took the survey multiple times are not exactly comparable to those who took only once.  

Suggested solution: Ability to select more than one role.  



2. Related to Issue 1, dpct sums up to 585. the question is only asked if conset==yes  which isnt in all cases  

 



```{r}

#END


```



# Next Steps in consideration  

1. Chi-sq/Fischer exact for demographic characteristics
2. Cochran Q test for multiple response questions. 
3. Hierarchical Clustering to identify characteristics associated with certain responses 
4. Multinomial logistics regression to test the effects of the identified characteristics dimension reduction


## Modeling.

A1. Feature selection using Principal Component Analysis  
2. Identify latent structures related to geography  

3a. Evaluate features based on Eigenvalues and factor matrix (retain those >1)  

3b. Evaluate features with permutation tests to test significance

B. Neural network node with RBF to identify dimensionality of the variables.  

C. XGBoost 

5. Perform Akaike Information Criteria (AIC) for each model  


6. Cluster analysis using KMC




```{r}

#transport modes cochran Q test
dataf_tx<-dataf[,c(1,14:20)]
for (i in 1:nrow(dataf_tx)){
  for (j in 1:ncol(dataf_tx)){
      if (dataf_tx[i,j]=="Checked"){dataf_tx[i,j]<-"1"}
    if (dataf_tx[i,j]=="Unchecked"){dataf_tx[i,j]<-"0"}
  }
}

```

